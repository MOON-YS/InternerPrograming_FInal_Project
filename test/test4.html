<!DOCTYPE html>
 <html>
 <head>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no,target-densitydpi=medium-dpi" />
   <meta name="apple-mobile-web-app-capable" content="no" />
   <meta name="apple-mobile-web-app-status-bar-style" content="black" />
   <title>JeongHun</title>
   <style>
      html {
        scroll-behavior: smooth;
      }
      ul {
        margin:0;
        padding:0;
        list-style-type: none;
      }

      #loadingScreen {
        display:block;
        position: absolute;
        top:-6%;
        left:0;
        z-index:2;
        width: 100%;
        height: 120%;
        margin: 0 auto;
        background-color: white;
        text-align: center;
        font-weight: bold;
        font-size:30px;
      }
      #loadingScreen p{
        margin-top:80%;
      }
      #background {
        width: 90%;
        height: 0px;
        margin: 0 auto;
      }
      #dropdown{
        display : none;
        width: 100%;
        height: 5%;
        margin: 0 auto;
        background-color: #113a6b;
      }
      #ButtonImage {
        display: block;
        width:40px;
        height: 90%;
        float:left ;
        margin-top: 2px;
        margin-left : 5px;
        padding-bottom : 0px;
        cursor:pointer;
        border-radius: 100%;
        transition:all ease 1s;
        box-shadow: 2px 2px 2px gray;
        background-color: #EAEAEA;
        text-align: center;
        font-weight: bold;
        font-size: 13px;
      }
      #ButtonImage p, #nowPlaying p {
        margin-top:10px
      }
      

      #main {
        position: relative;
        width: 100%;
        height: 85%;
        margin: 0 auto;
        background-color: antiquewhite; 
        transition:all ease 0.5s;
      }
      #hiddenList {
        position: absolute;
        top:0;
        left:0;
        z-index:1;
        background-color: white;
        background-color:rgba(0, 0, 0, 0.5);/*까만색(0,0,0) 20% 투명도*/
        width: 0%;
        height: 100%;
        margin: 0;
        padding:0;
        transition:all ease 0.5s;
      }
      .test_obj input[type="radio"] {
        display: none;
    }
 
    .test_obj input[type="radio"] + span {  
        margin-left: 10px;
        width:98px;
        height: 20px;
        display: block;
        padding: 15px 10px;
        border: 1px solid #dfdfdf;
        background-color: #ffffff;
        text-align: center;
        cursor: pointer;
        margin-top:5px;
    }
 
    .test_obj input[type="radio"]:checked + span {
        background-color: #113a6b;
        color: #ffffff;
    }
    .test_obj input[type="radio"] + span:hover {
      background-color: #113a6b;
      color: #ffffff;
    }
      

      #hiddenList_content_ul {
       display: none;
       opacity: 0;
       transition:all ease 0.5s;
       width: 98px;
       font-weight: 500;
      }

      #main #main_section1 {
        position: absolute;
        top:0;
        left:0;
        z-index:0;
        width: 100%;
        height: 100%;
        margin: 0 auto;
        transition:all ease 0.5s;
      }
      #main #map {
        display : block;
        width: 100%;
        height: 77%;
        margin: 0 auto;
      }

      #main #scrollBar {
        width:100%; height:22%; overflow-x:auto; white-space:nowrap; margin:0 auto;   
        border-bottom-left-radius: 10px;
        border-bottom-right-radius: 10px;
        background-color: lightblue;
        white-space: nowrap;  
      }
      

      #footer {
        display:none;
        z-index:1;
        width: 100%;
        height: 10%;
        background-color: #113a6b;
      
      }
      #naviIcon, #mapIcon, #reservationIcon{
        display: block;
        float:left;
        margin-top:15px;
        width: 60px;
        height: 60px;
        margin-left:10%;
        background-color: #EAEAEA;
        border-radius: 100%;
        cursor:pointer;
        text-align: center;
        transition:all ease 0.5s;
      }



      #scrollBar > ul { font-size:0px; text-overflow : scroll;}
      #scrollBar > ul > li {
        display:inline-block; 
        font-size:10px; 
        text-align: center;
        width:30%; height:100px; 
        background:#EAEAEA;
        overflow-x:auto; white-space:nowrap;
        margin-right:10px;
        padding-top:20px;
      }
      #performanceDetailInformation {
        overflow-y:auto; overflow-X:auto; white-space:nowrap;
        word-break:break-all;
        width: 0px;
        height: 0px;
        margin: 0 auto;
        margin-top : 20px;
        margin-right: 0px;
        border-radius: 20%;
        text-align: center;
        background-color: #BCE55C;
        box-shadow: 20px 20px 20px gray;
        transition:all ease 0.5s;
        font-size:15px;
        letter-spacing:-0.5px;
      }
      #performanceDetailInformation h4 {
        margin-bottom: 5px;
        font-weight: bold;
      }
      #performanceDetailInformation:hover {
        background-color: #EAEAEA;
      }

      #dateDesignation {
        margin-top:3%;
        margin-left: 10%;
        cursor:pointer;
        transition:all ease 1s;
        box-shadow: 2px 2px 2px gray;
        background-color: #EAEAEA;
      }
      #dataDesignation_send {
        margin-top:3%;
        cursor:pointer;
        transition:all ease 1s;
        box-shadow: 2px 2px 2px gray;
        background-color: #EAEAEA;
      }
      #nowPlaying {
        display: block;
        width:40px;
        height: 90%;
        float:left ;
        margin-top: 2px;
        margin-left:8px;
        margin-right : 5px;
        padding-bottom : 0px;
        cursor:pointer;
        border-radius: 100%;
        transition:all ease 1s;
        box-shadow: 2px 2px 2px gray;
        background-color: #EAEAEA;
        text-align: center;
        font-weight: bold;
        font-size: 8px;
      }
   </style>
 </head>
 <body>
  <!-- <script>
    function isMobile() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }
    if (isMobile()) {
        console.log("platform is mobile");
        alert("모바일");
        window.location.href = "./mobile.html"

    } else {
        alert("pc");
        console.log("platform is pc");
    }
  </script> -->
   <div id = "background">
     <header id ="dropdown">
      <div id = "ButtonImage"><p>click</p></div>
      <div class = "false" id ="nowPlaying" style = "width:40px;"><p style="display: block;">Playing..</p></div>
      <input class = "false" id = "dateDesignation" type='date'>
      <input class = "false" id = "dataDesignation_send" type ="submit" value="확인">
     </header>
     <main id = "main">
       <div id="loadingScreen"><p>Loading...</p></div>
       <div id = "hiddenList">
          <ul id = "hiddenList_content_ul">
            <li><label class="test_obj"><input id = "checkMusical" type="radio" name="radioButton" value="musical" checked><span>뮤지컬</span></label></li>
            <li><label class="test_obj"><input id = "checkOpera" type="radio" name="radioButton" value="opera"><span>오페라</span></label></li>
            <li><label class="test_obj"><input id = "checkPlay" type="radio" name="radioButton" value="play"><span>연극</span></label></li>
          </ul>
       </div>
       <section id = "main_section1">
         <div id = "map">
         </div>
         <div id = "scrollBar">
            <ul id = "scrollBar_ul"></ul>
         </div>
         <div id = "performanceDetailInformation"></div>
         <!-- <a href="#" onclick="navi();">click</a> -->
       </section>
      
     </main>
     <footer id ="footer">
       <div id ="naviIcon"><p style="font-size: 13px;font-weight: bold;margin-top: 15px;">카카오<br>네비</p></div>
       <div id ="mapIcon"><p style="font-size: 14px;font-weight: bold;margin-top: 20px;">카카오맵</p></div>
       <div id ='reservationIcon'><p style="font-size: 15px;font-weight: bold;margin-top: 20px;">예매</p></div>
      </footer>
   </div>
   
   <script type="text/javascript" src = "https://dapi.kakao.com/v2/maps/sdk.js?appkey=3f5d2674c29eb3cb86007a28668890f6&libraries=services"></script>
   <script type="text/javascript" src = "https://developers.kakao.com/sdk/js/kakao.js"></script>
   <!-- <script type="text/javascript" src = "https://dapi.kakao.com/v2/maps/sdk.js?appkey=3f5d2674c29eb3cb86007a28668890f6&libraries=services&autoload=false"></script> -->
   <script>
     //모바일 해상도 설정
      var background = document.querySelector('#background');
      background.style.height = `${screen.height}px`;
   </script>

   <script>
        //--------------------변수 및 메소드 선언-------------------
        const musicalJson = 'https://moonjeonghunapp1.herokuapp.com/http://apis.data.go.kr/6260000/BusanCultureMusicalDetailService/getBusanCultureMusicalDetail?serviceKey=5WFmQsUZpTifa4SpNtPI1z1RqC721HbHHo937DJt9NYV1lr50bhm15x7cpREJ14DSBtNtOm5C3Oz0CFckeUeAA%3D%3D&pageNo=1&numOfRows=1000&resultType=json';
        const operaJson =   'https://moonjeonghunapp1.herokuapp.com/http://apis.data.go.kr/6260000/BusanCultureOperaDetailService/getBusanCultureOperaDetail?serviceKey=5WFmQsUZpTifa4SpNtPI1z1RqC721HbHHo937DJt9NYV1lr50bhm15x7cpREJ14DSBtNtOm5C3Oz0CFckeUeAA%3D%3D&pageNo=1&numOfRows=1000&resultType=json';
        const playJson =    'https://moonjeonghunapp1.herokuapp.com/http://apis.data.go.kr/6260000/BusanCulturePlayDetailService/getBusanCulturePlayDetail?serviceKey=5WFmQsUZpTifa4SpNtPI1z1RqC721HbHHo937DJt9NYV1lr50bhm15x7cpREJ14DSBtNtOm5C3Oz0CFckeUeAA%3D%3D&pageNo=1&numOfRows=1000&resultType=json'
        const place =       'https://moonjeonghunapp1.herokuapp.com/http://apis.data.go.kr/6260000/BusanCulturePerformPlaceService/getBusanCulturePerformPlace?serviceKey=5WFmQsUZpTifa4SpNtPI1z1RqC721HbHHo937DJt9NYV1lr50bhm15x7cpREJ14DSBtNtOm5C3Oz0CFckeUeAA%3D%3D&pageNo=1&numOfRows=1000&resultType=json'
    
        var dataPane = document.getElementById("sample_data");
        var today = getToday(); //현재 날짜 yyyy-mm-dd 형태 반환
        var placeInformation= []; //공연장 장소 저장
        var musicalInformation = [];
        var musicalMarker = [];
        var operaInformation = [];
        var operaMarker = [];
        var playInformation = [];
        var playMarker = [];
        var tempMusicalInformation = []; //현재 상영중인 공연 보여줄 때 현재 화면에 출력된 공연 정볼르 임시로 저장할 배열 변수
        var tempOperaInformation = []; //현재 상영중인 공연 보여줄 때 현재 화면에 출력된 공연 정볼르 임시로 저장할 배열 변수
        var tempPlayInformation = []; //현재 상영중인 공연 보여줄 때 현재 화면에 출력된 공연 정볼르 임시로 저장할 배열 변수
        var cilckMarker; //특정 위치 마커
        var currentMakerLength=0; //현재 화면에 보이는 마커의 개수를 저장해줌

        var scrollBar = document.querySelector('#scrollBar');
        var scrollBar_ul = document.querySelector('#scrollBar_ul');
        var idMainTag = document.querySelector('#main');
        var idMain_section1Tag = document.querySelector('#main_section1');
        var headerTag = document.querySelector('#dropdown');
        var footer = document.querySelector('#footer');
        var scrollBar_ul_childCount = document.querySelector('#scrollBar_ul');
        var performanceDetailInformation = document.querySelector('#performanceDetailInformation');
        var checkMusical = document.querySelector('#checkMusical');
        var checkOpera = document.querySelector('#checkOpera');
        var checkPlay = document.querySelector('#checkPlay');
        var hiddenbutton = document.querySelector('#ButtonImage');
        var hiddenList = document.getElementById('hiddenList');
        var hiddenList_content = document.getElementById('hiddenList_content');
        var hiddenList_content_ul = document.getElementById('hiddenList_content_ul');
        var nowPlaying = document.querySelector('#nowPlaying');
        var dateDesignation = document.querySelector('#dateDesignation');
        var dataDesignation_send = document.querySelector('#dataDesignation_send');
        var userInputDateValue;
        //footer 3가지 이벤트 등록
        var naviIcon = document.querySelector('#naviIcon');
        var mapIcon = document.querySelector('#mapIcon');
        var reservationIcon = document.querySelector('#reservationIcon');
        Kakao.init('3f5d2674c29eb3cb86007a28668890f6')


      
    
        var mapContainer = document.getElementById('map') // 지도를 표시할 div 
        var mapOption = {
            center: new kakao.maps.LatLng(35.13417, 129.11397), // 지도의 중심좌표
              level: 7, // 지도의 확대 레벨
              mapTypeId : kakao.maps.MapTypeId.ROADMAP,
        }; 
        
        // 지도를 생성한다 
        var map = new kakao.maps.Map(mapContainer, mapOption); 
        var ps = new kakao.maps.services.Places();

        function showMarkers() {
            setMarkers(map)    
        }  

        function setMarkers(map) {
            if(checkMusical.checked) {
              for (let i = 0; i < currentMakerLength; i++) {
                musicalMarker[i].setMap(map);
              }  
            }
            else if(checkOpera.checked) {
              for (let i = 0; i < currentMakerLength; i++) {
                operaMarker[i].setMap(map);
              }  
            }
            else if(checkPlay.checked) {
              for (let i = 0; i < currentMakerLength; i++) {
                playMarker[i].setMap(map);
              }  
            }           
        }
        function visibleHeaderElement(str) {
          if(str == 'viewDateOnly') {
            dateDesignation.style.opacity = '1';
            dateDesignation.style.visibility = 'visible';
            dataDesignation_send.style.opacity = '1';
            dataDesignation_send.style.visibility = 'visible';
            dataDesignation_send.value ='확인';
          }
          else if(str=='viewPlayingOnly') {
            nowPlaying.style.opacity = '1';
            nowPlaying.style.visibility = 'visible';
            nowPlaying.firstChild.style.display = 'block';
          }
          else if(str =="ALL") {
            nowPlaying.style.opacity = '1';
            nowPlaying.style.visibility = 'visible';
            nowPlaying.firstChild.style.display = 'block';
            dateDesignation.style.opacity = '1';
            dateDesignation.style.visibility = 'visible';
            dataDesignation_send.style.opacity = '1';
            dataDesignation_send.style.visibility = 'visible';
            dataDesignation_send.value ='확인';
          }
        }

        function hiddenHeaderElement() {
          nowPlaying.style.opacity = '0';
          nowPlaying.style.visibility = 'hidden';
          nowPlaying.firstChild.style.display = 'none';
          dateDesignation.style.opacity = '0';
          dateDesignation.style.visibility = 'hidden';
          dataDesignation_send.style.opacity = '0';
          dataDesignation_send.style.visibility = 'hidden';
          dataDesignation_send.value ='     ';
        }

        function performanceDetailInformation_eventMethod() {
              if(dataDesignation_send.style.backgroundColor =='rgb(188, 229, 92)') {
                visibleHeaderElement('viewDateOnly');
              }
              else if(nowPlaying.style.backgroundColor =='rgb(188, 229, 92)') {
                visibleHeaderElement('viewPlayingOnly');
              }
              else {
                visibleHeaderElement('ALL');
              }

            if(performanceDetailInformation.style.width=='100%') {
              naviIcon.style.backgroundColor = "#EAEAEA"
              mapIcon.style.backgroundColor = "#EAEAEA"
              reservationIcon.style.backgroundColor = "#EAEAEA"
              while ( performanceDetailInformation.hasChildNodes() ) { performanceDetailInformation.removeChild( performanceDetailInformation.firstChild ); }// 태그 초기화
              //설명창 닫으면 li중 배경 색이 skyblue 이면 skyblue->#EAEAEA로 변경
              for(let i = 0; i < scrollBar_ul_childCount.childElementCount; i++) {
                var color = scrollBar_ul_childCount.children[i].style.backgroundColor;
                if(color == "rgb(96, 63, 131)" || color == "rgb(250, 208, 201)" || color == "rgb(43, 174, 102)") {
                  scrollBar_ul_childCount.children[i].style.backgroundColor = "#EAEAEA";
                  break;
                }
              }
              showMarkers();
              cilckMarker.setMap(null);
              performanceDetailInformation.style.width = '0px';
              performanceDetailInformation.style.height = '0px';
              idMainTag.style.height = '85%'; //원래 크기 복구
              idMain_section1Tag.style.height = '100%'; //원래 크기 복구
            }
            
          }

        function detailScreenEventSet() {
          
          //뮤지컬 상세보기 창 클릭시 이벤트
          performanceDetailInformation.onclick = function() {
            performanceDetailInformation_eventMethod();
          }
        }

        function checkBoxEvent_sub_content(performanJson, PerformanceInformation, performaceMaker) {
          let j = 0;
          let temp = [];
          //Playing...버튼을 누른채로 드롭다운 중 뮤지컬을 클릭했을 때 현제 시각 기준 상영하고 있는 뮤지컬 정보만 출력해줌
          if(PerformanceInformation == musicalInformation && nowPlaying.className=='true') {
            for(let i = 0; i <musicalInformation.length; i++) {
              if(musicalInformation[i].op_st_dt <= today) {
                temp[j] = musicalInformation[i]; j++;
              }
            }
           
            musicalInformation = [...temp];
            showPerformance(musicalInformation, musicalMarker);
            
          }  
          else if(PerformanceInformation == operaInformation && nowPlaying.className=='true') {
            for(let i = 0; i <operaInformation.length; i++) {
              if( operaInformation[i].op_st_dt <= today) {
                temp[j] = operaInformation[i]; j++;
              }
            }
           
            operaInformation = [...temp];
            showPerformance(operaInformation, operaMarker);
            
          } 
          else if(PerformanceInformation == playInformation && nowPlaying.className=='true') {
            for(let i = 0; i <playInformation.length; i++) {
              if( playInformation[i].op_st_dt <= today) {
                temp[j] = playInformation[i]; j++;
              }
            }
            playInformation = [...temp];
            showPerformance(playInformation, playMarker);
          }  
          else if(dataDesignation_send.className=='true') {sub_sub_dateDesignation_send();} //사용자가 입력한 날짜 기준 공연 정보 출력하기
          else {showPerformance(PerformanceInformation, performaceMaker);} //날짜 지정도 Playing.. 버튼도 둘 다 안 누른 경우
          
              
          hiddenbutton.style.transform="rotate(0deg)";
          hiddenList_content_ul.style.opacity = '0';
          hiddenList.style.width='0%';
          hiddenList_content_ul.style.display = 'none';
          if(dataDesignation_send.style.backgroundColor =='rgb(188, 229, 92)') {
              visibleHeaderElement('viewDateOnly');
          }
          else if(nowPlaying.style.backgroundColor =='rgb(188, 229, 92)') {
            visibleHeaderElement('viewPlayingOnly');
          }
          else {
            visibleHeaderElement('ALL');
          }
         // hiddenList_content.style.width = '0px';
        }

        function checkBoxEvent() {
          checkMusical.onclick = function() {
            if(checkMusical.checked) {
              musicalInformation = [...tempMusicalInformation]; //원본인 tempMusicalInformation의 값을 가져옴
              if(performanceDetailInformation.style.width == '100%') {
                checkBoxEvent_sub_content(musicalJson, musicalInformation, musicalMarker);
                performanceDetailInformation_eventMethod();
              }
              else {
                checkBoxEvent_sub_content(musicalJson, musicalInformation, musicalMarker);
              }
              
            }
          }
          checkOpera.onclick = function() {
            if(checkOpera.checked) {
              operaInformation = [...tempOperaInformation]; //원본인 tempOperaInformation 값을 가져옴
              if(performanceDetailInformation.style.width == '100%') {
                checkBoxEvent_sub_content(operaJson, operaInformation, operaMarker);
                performanceDetailInformation_eventMethod();
              }
              else {
                checkBoxEvent_sub_content(operaJson, operaInformation, operaMarker);
              }
              
            }
          }
          checkPlay.onclick = function() {
            if(checkPlay.checked) {
              playInformation = [...tempPlayInformation]; //원본인 tempPlayInformation 값을 가져옴
              if(performanceDetailInformation.style.width == '100%') {
                checkBoxEvent_sub_content(playJson, playInformation, playMarker);
                performanceDetailInformation_eventMethod();
              }
              else {
                checkBoxEvent_sub_content(playJson, playInformation, playMarker);
              }
              
            }
          }
        }
        //현재기능-괄호 앞 키워드까지만 검색
        function keywordFilter(str) {
            var arr = str.split('');//문자별로 분할
            var indexNum;
            for (var i = 0; i < arr.length; i++) {
                if (arr[i] == '(' || arr[i] == '[') { //괄호 검색
                    indexNum = i;//괄호의 인덱스 저장
                }
            }

            var result = arr.join('');
            result = result.substring(0, indexNum);//제일앞부터 괄호앞까지 자르기
            return result; //스트링으로 변환하여 반환

        }

        //검색결과가 같은지 반환
      //공연데이터에 포함된 공연장 이름과 카맵에서 검색한 장소 둘을 비교해주는함수
      function isSame(str1, str2) {
          //console.log("start")
          var isSame = false;
          //console.log("first "+str1+" "+str2)
          if (str1 == str2) {//두 문자열이 완전 일치
              isSame = true;
          }
          else {
              var secondCompareStr1 = keywordFilter(str1).replace(/(\s*)/g, "");
              var secondCompareStr2 = keywordFilter(str2).replace(/(\s*)/g, "");
              //console.log("second "+secondCompareStr1+" "+secondCompareStr2);
              if (secondCompareStr1 == secondCompareStr2) {//괄호와 공백을 제거한 두문자열의 일치
                  isSame = true;
              }
              else {
                  var noSpaceStr1 = str1.replace(/(\s*)/g, "");//공백제거
                  var noSpaceStr2 = str2.replace(/(\s*)/g, "");
                  var strArrS = noSpaceStr1.split('');//작은문자열(검사전)
                  var strArrB = noSpaceStr2.split('');//큰문자열(검사전)
                  if (strArrB.length < strArrS.length) {//검사하고 이름에맞게 맞춰줌
                      var temp = strArrS;
                      strArrS = strArrB;
                      strArrB = temp;
                  }
                  //console.log("third "+strArrB+" "+strArrS);
                  if (strArrB == strArrS) {//정제한 문자열이 같으면 true
                      isSame = true;
                  }
                  else {
                      for (var i = 0; i < strArrS.length; i++) {//큰문자열앞부터에 끝까지에 작은문자열이 포함되있는지 검사
                          //console.log(strArrS);
                          if (strArrS[i] != strArrB[i]) {//중간에 같지않으면 break하고 false값 반환
                              //console.log("forth not Matched "+strArrS+" "+strArrB);
                              isSame = false;
                              var forthStr1 = keywordFilter(str1)//괄호및 공백제거
                              forthStr1 = forthStr1.replace(/(\s*)/g, "");

                              var forthStr2 = keywordFilter(str2)
                              forthStr2 = forthStr2.replace(/(\s*)/g, "");

                              forthStr1 = forthStr1.replace("부산", '');//부산 제거
                              forthStr2 = forthStr2.replace("부산", '');
                              //console.log("fifth "+forthStr1+" "+forthStr2);
                              if (forthStr1 == forthStr2) {
                                  isSame = true;
                              }
                              else {
                                  //console.log("ended with no match")
                                  isSame = false//분기의 마지막
                              }
                              break;
                          } else {
                              isSame = true;//for문이 도중에 멈추지않았다면 true
                          }
                      }
                  }
              }
          }

          return isSame;
      }//show 배열에따라 마커추가
        function showPerformance(performanceInfor, performaceMaker) {
          //-------------맵에 마커 출력---------------------------------------------------- 
          //기존 마커들 모두 제거
          for (let i = 0; i < musicalMarker.length; i++)  musicalMarker[i].setMap(null);
          for (let i = 0; i < operaMarker.length; i++)  operaMarker[i].setMap(null);
          for (let i = 0; i < playMarker.length; i++)  playMarker[i].setMap(null);
          for(let i =0 ; i<musicalMarker.length; i++) musicalMarker.pop();
          for(let i =0 ; i<operaMarker.length; i++) operaMarker.pop();
          for(let i =0 ; i<playMarker.length; i++) playMarker.pop();

          // 지도에 마커를 생성하고 표시한다
          let j;
          currentMakerLength=0;
          for(let i=0; i < performanceInfor.length; i++) {
            var placeObject;
            for(j = 0; j < placeInformation.length; j++) {
              if(placeInformation[j].placeId == performanceInfor[i].place_id) {
                placeObject = placeInformation[j];
                //뮤지컬 요소 객체에 위도 경도 추가
                performanceInfor[i].lttd = placeObject.lttd;
                performanceInfor[i].lngt = placeObject.lngt;
                performanceInfor[i].addr = placeObject.addr;
                break;
              }
            }
            if(j == placeInformation.length) {
             
              // 키워드 검색 완료 시 호출되는 콜백함수 입니다
              let placesSearchCB = function (data, status, pagination) {
                  if (status === kakao.maps.services.Status.OK) {
                      // 검색된 장소 위치를 기준으로 지도 범위를 재설정하기위해
                      // LatLngBounds 객체에 좌표를 추가합니다
                      var bounds = new kakao.maps.LatLngBounds();

                      for (let k=0; k<1; k++) {
                          displayMarker(data[k]);    
                          bounds.extend(new kakao.maps.LatLng(data[k].y, data[k].x));
                          //뮤지컬 요소 객체에 위도 경도 추가
                      }      
                  } 
                  //장소 조회가 안된 경우
                  else {
                    performanceInfor[i].lttd = "";
                  }
              }

              // 지도에 마커를 표시하는 함수입니다
              let displayMarker = function (place) {
                  var imageSrc; 
                  if(performanceInfor == musicalInformation) {imageSrc = 'https://mpv990422.duckdns.org/imgs/markerImg/purple.png';}
                  else if(performanceInfor == operaInformation){imageSrc = 'https://mpv990422.duckdns.org/imgs/markerImg/pink.png';}
                  else if(performanceInfor == playInformation) {imageSrc = 'https://mpv990422.duckdns.org/imgs/markerImg/green.png';}
                  
                  var imageSize = new kakao.maps.Size(30,40);
                  var imageOption = {offset: new kakao.maps.Point(27, 69)}; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.
                  var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);
                  var infoWindow = new kakao.maps.InfoWindow({
                      content: `Location: ${performanceInfor[i].place_nm}
                      Title: ${performanceInfor[i].title}`,
                  });
                  
                  // 마커를 생성하고 지도에 표시합니다
                  var marker = new kakao.maps.Marker({
                    position: new kakao.maps.LatLng(place.y, place.x),   
                    image: markerImage
                  });
                  marker.setMap(map);
                  performanceInfor[i].lttd = place.y;
                  performanceInfor[i].lngt = place.x;
                  performanceInfor[i].addr = place.place_name;

                  //kakao.maps.event.addListener(marker, "clickz", mouseOverListener(map, marker, infoWindow)); 
                  //kakao.maps.event.addListener(marker, "focusout", mouseOutListener(infoWindow))
                
                  performaceMaker[currentMakerLength] = marker;  // 생성된 마커를 배열에 추가합니다
                  currentMakerLength++;
              }
              ps.keywordSearch("부산 "+keywordFilter(performanceInfor[i].place_nm), placesSearchCB);   
            }   

            else {
              var lat = placeObject.lttd; //위도 저장
              var lng = placeObject.lngt; //경도 저장
              var imageSrc; 
              if(performanceInfor == musicalInformation) {imageSrc = 'https://mpv990422.duckdns.org/imgs/markerImg/purple.png';}
              else if(performanceInfor == operaInformation){imageSrc = 'https://mpv990422.duckdns.org/imgs/markerImg/pink.png';}
              else if(performanceInfor == playInformation) {imageSrc = 'https://mpv990422.duckdns.org/imgs/markerImg/green.png';}
                  
              var imageSize = new kakao.maps.Size(30,40);
              var imageOption = {offset: new kakao.maps.Point(27, 69)}; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.
              var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);
              var infoWindow = new kakao.maps.InfoWindow({
                  content: `Location: ${performanceInfor[i].place_nm}
                  Title: ${performanceInfor[i].title}`,
              });
                  
              // 마커를 생성하고 지도에 표시합니다
              var marker = new kakao.maps.Marker({
                position: new kakao.maps.LatLng(lat, lng),   
                image: markerImage
              });
              marker.setMap(map);

              

              var infoWindow = new kakao.maps.InfoWindow({
                content: `Location: ${performanceInfor[i].place_nm}
                Title: ${performanceInfor[i].title}`,
              });
              // 마커 추가
                    
              // 마커 이벤트리스너 등록
              //kakao.maps.event.addListener(marker, "click", mouseOverListener(map, marker, infoWindow)); 
              //kakao.maps.event.addListener(marker, "focusout", mouseOutListener(infoWindow));
              
              performaceMaker[currentMakerLength]=marker;  // 생성된 마커를 배열에 추가합니다
              currentMakerLength++;
            }
          }

          function setMarkers(map) {
              for (let i = 0; i < performaceMaker.length; i++) {
                performaceMaker[i].setMap(map);
              }            
          }
          // "마커 감추기" 버튼을 클릭하면 호출되어 배열에 추가된 마커를 지도에서 삭제하는 함수입니다
          function hideMarkers() {
              setMarkers(null);    
          }

          //해당 위도 경도로 맵 위치 이동 
          function setFocusCenter(lt, ln) {
            var movaLatLon = new kakao.maps.LatLng(lt, ln);
            map.setCenter(movaLatLon);
          }

          //----스크롤에 목록 저장-----------------------------

          while ( scrollBar_ul.hasChildNodes() ) { scrollBar_ul.removeChild( scrollBar_ul.firstChild ); }// 태그 초기화
          for(let i = 0; i < performanceInfor.length; i++) {
                const li  = document.createElement('li');
                li.insertAdjacentHTML('beforeend', `${performanceInfor[i].title}<br><br>
                ${performanceInfor[i].op_st_dt} ~ ${performanceInfor[i].op_ed_dt}<br><br>
                ${performanceInfor[i].runtime}`);
                scrollBar_ul.appendChild(li);
                li.style.boxShadow = '5px 5px 5px gray';
                li.style.borderRadius = "10px";
                li.style.fontWeight= 'bold';
                if(performanceInfor==musicalInformation) {
                  li.style.border = '2px solid #603f83'
                }
                else if(performanceInfor==operaInformation){
                  li.style.border = '2px solid #fad0c9'
                }
                else if(performanceInfor==playInformation){
                  li.style.border = '2px solid #2bae66'
                }
                li.onclick = function(event) {
                  if(performanceDetailInformation.style.width == '100%') {
                    performanceDetailInformation_eventMethod();
                    hiddenHeaderElement();
                  }
                  if(performanceDetailInformation.style.width == '0px' || performanceDetailInformation.style.width =="") {
                    hiddenHeaderElement();
                    if(performanceInfor==musicalInformation) {event.target.style.backgroundColor = "#603f83";}
                    else if(performanceInfor == operaInformation){event.target.style.backgroundColor = "#fad0c9";}
                    else if(performanceInfor == playInformation) {event.target.style.backgroundColor = "#2bae66";}
                    
                    if( performanceInfor[i].lttd == "") {
                      hideMarkers();
                      alert("장소를 조회할 수 없습니다. \n뮤지컬 정보만 표시합니다.");
                    }
                    else {
                      hideMarkers();
                      var imageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png', // 마커이미지의 주소입니다    
                      imageSize = new kakao.maps.Size(40, 50), // 마커이미지의 크기입니다
                      imageOption = {offset: new kakao.maps.Point(27, 69)}; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.
                      // 마커의 이미지정보를 가지고 있는 마커이미지를 생성합니다.

                      var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption),
                          markerPosition = new kakao.maps.LatLng(performanceInfor[i].lttd, performanceInfor[i].lngt); // 마커가 표시될 위치입니다

                      // 마커를 생성합니다
                      cilckMarker = new kakao.maps.Marker({
                          position: markerPosition, 
                          image: markerImage // 마커이미지 설정 
                      });

                      cilckMarker.setMap(map);
                      setFocusCenter(performanceInfor[i].lttd, performanceInfor[i].lngt);
                    }

                    idMainTag.style.height = '115%'; ///80%->120%
                    idMain_section1Tag.style.height = '70%'; ///100%->65%
                    performanceDetailInformation.style.width = '100%';
                    performanceDetailInformation.style.height = '250px';  

                    /*여기다 뮤지컬 정보 표시*/
                    for(let i = 0; i < scrollBar_ul_childCount.childElementCount; i++) {
                      var color = scrollBar_ul_childCount.children[i].style.backgroundColor;
                      if( color == "rgb(96, 63, 131)" || color == "rgb(250, 208, 201)" || color == "rgb(43, 174, 102)") {
                        performanceDetailInformation.insertAdjacentHTML('beforeend', 
                      `<h4>Title: </h4>${performanceInfor[i].title}<br>
                        <h4>Date: </h4>${performanceInfor[i].op_st_dt} ~ ${performanceInfor[i].op_ed_dt}<br>
                        <h4>Location: </h4>${performanceInfor[i].place_nm}<br>
                        <h4>Runtime: </h4>${performanceInfor[i].runtime}<br>
                        <h4>Showtime: </h4>${performanceInfor[i].showtime}<br>
                        <h4>Rating: </h4>${performanceInfor[i].rating}<br>
                        <h4>Price: </h4>${performanceInfor[i].price}<br>
                        <h4>Casting: </h4>${performanceInfor[i].casting}<br>
                        <h4>Enterprise: </h4>${performanceInfor[i].enterprise}<br>
                        <h4>More Information And Reservation: </h4><a href = "${performanceInfor[i].dabom_url}" target="_blank">${performanceInfor[i].dabom_url}</a><br><br><br>
                        `);
                        break;
                      }
                    }
                  } 
                }
            }      

          //footer 3가지 이벤트 등록
          naviIcon.onclick = function() {
            for(let i = 0; i < scrollBar_ul_childCount.childElementCount; i++) {
              var color = scrollBar_ul_childCount.children[i].style.backgroundColor;
                if(color == "rgb(96, 63, 131)" || color == "rgb(250, 208, 201)" || color == "rgb(43, 174, 102)") {
                  if(performanceInfor[i].lttd == "") {
                    alert("장소를 조회할 수 없어 네비게이션으로 이동하지 않습니다.\n상세보기란에서 위치를 확인해주세요.");
                    return;
                  }
                  else {
                    naviIcon.style.backgroundColor = "#BCE55C"
                    Kakao.Navi.start({
                      name: performanceInfor[i].addr,
                      x: Number(performanceInfor[i].lngt),
                      y: Number(performanceInfor[i].lttd),
                      coordType: 'wgs84'
                    });
                    return;
                  }
                } 
            }
            alert(`공연을 선택하세요!`);
          }
        
          mapIcon.onclick = function() {
            for(let i = 0; i < scrollBar_ul_childCount.childElementCount; i++) {
              var color = scrollBar_ul_childCount.children[i].style.backgroundColor;
                if(color == "rgb(96, 63, 131)" || color == "rgb(250, 208, 201)" || color == "rgb(43, 174, 102)") {
                  if(performanceInfor[i].lttd == "") {
                    alert("장소를 조회할 수 없어 카카오맵으로 이동하지 않습니다.\n상세보기란에서 위치를 확인해주세요.");
                    return;
                  }
                  else {
                    mapIcon.style.backgroundColor = "#BCE55C"
                    var url2 = `https://map.kakao.com/link/to/${performanceInfor[i].addr},${performanceInfor[i].lttd},${performanceInfor[i].lngt}`;
                    window.open(url2);
                    return;
                  }
                }
            }
            alert(`공연을 선택하세요!`);
          }

          reservationIcon.onclick = function() {
            for(let i = 0; i < scrollBar_ul_childCount.childElementCount; i++) {
              var color = scrollBar_ul_childCount.children[i].style.backgroundColor;
                if(color == "rgb(96, 63, 131)" || color == "rgb(250, 208, 201)" || color == "rgb(43, 174, 102)") {
                  reservationIcon.style.backgroundColor = "#BCE55C"
                  window.open(performanceInfor[i].dabom_url);
                  return;
                }
            }
            alert(`공연을 선택하세요!`);
          }
        }

        function getToday () {
            var date = new Date();
            var year = date.getFullYear();
            var month = ("0" + (1 + date.getMonth())).slice(-2);
            var day = ("0" + date.getDate()).slice(-2);
            return year +'-'+ month +'-' + day;
        }
         // 인포윈도우 표시 열기
        function mouseOverListener(map, marker, infoWindow) {
          return function () {
            infoWindow.open(map, marker);
          };
        }
        // 인포윈도우 표시 닫기
        function mouseOutListener(infoWindow) {
          return function () {
            infoWindow.close();
          };
        }
        //매개변수로 전달된 json 공연 데이터를 정렬해주는 함수
        function sortDate(arrData) {
            for (var i = arrData.length - 1; i > 0; i--) {
                for (var j = 0; j < i; j++) {
                    if (arrData[j].op_ed_dt > arrData[j + 1].op_ed_dt) {
                        var temp = arrData[j];
                        arrData[j] = arrData[j + 1];
                        arrData[j + 1] = temp;
                    }
                    else if (arrData[j].op_ed_dt == arrData[j + 1].op_ed_dt) {
                        if (arrData[j].op_st_dt > arrData[j + 1].op_st_dt) {
                            var temp = arrData[j];
                            arrData[j] = arrData[j + 1];
                            arrData[j + 1] = temp;
                        }
                    }
                }
            }
            return arrData;
        }
        
        
        detailScreenEventSet();
        checkBoxEvent();
        //---------------공연장 이름, 뮤지컬 정보 추출----------------------------------- 

        fetch(place)
        .then(res => res.json())
        .then(resJson => {
            var center = resJson.getBusanCulturePerformPlace.item;
            var totalCount = resJson.getBusanCulturePerformPlace.totalCount;  
            for(let i =0; i<totalCount; i++) {
                placeInformation.push(center[i]); //전체 공연장 정보 {} 객체를 placeInformation에 저장
            }
        });

        fetch(musicalJson)
        .then(res => res.json())
        .then(resJson => {
            var musical = resJson.getBusanCultureMusicalDetail.item;
            var totalCount = resJson.getBusanCultureMusicalDetail.totalCount;
            for(let i = 0; i < totalCount; i++) {
                //현재 시각 기준 공연 예정인 뮤지컬만 추출
                if(musical[i].op_ed_dt >= today) {
                    musicalInformation.push(musical[i]);
                }
            }
            
            sortDate(musicalInformation);
            showPerformance(musicalInformation, musicalMarker);
            var loadingScreen = document.querySelector('#loadingScreen');
            loadingScreen.style.display='none';
            footer.style.display = 'block';
            headerTag.style.display='block'
            //전역 코드의 마지막으로 선언된 비동기 함수가 끝나면 로딩창 끄기
            tempMusicalInformation = [...musicalInformation];
        });

        fetch(operaJson)
        .then(res => res.json())
        .then(resJson => {
            var performance;
            var totalCount;
            performance = resJson.getBusanCultureOperaDetail.item;
            totalCount = resJson.getBusanCultureOperaDetail.totalCount;
            for(let i = 0; i<operaInformation.length; i++) operaInformation.pop();
              let j = 0;
            for(let i = 0; i < totalCount; i++) {
                //현재 시각 기준 공연 예정인 뮤지컬만 추출
                if(performance[i].op_ed_dt >= today) {
                   operaInformation[j] = performance[i];
                  j++;
                }
            }
            tempOperaInformation = [...operaInformation];
        });

        fetch(playJson)
        .then(res => res.json())
        .then(resJson => {
            var performance;
            var totalCount;
            performance = resJson.getBusanCulturePlayDetail.item;
            totalCount = resJson.getBusanCulturePlayDetail.totalCount;
            for(let i = 0; i<playInformation.length; i++) playInformation.pop();
            let j = 0;
            for(let i = 0; i < totalCount; i++) {
                //현재 시각 기준 공연 예정인 뮤지컬만 추출
                if(performance[i].op_ed_dt >= today) {
                  playInformation[j] = performance[i];
                  j++;
                }
            }
            tempPlayInformation = [...playInformation];
        });

        //드롭다운 클릭시 이벤트 구현
        hiddenbutton.onclick = function() {
          if(hiddenList.style.width=="" || hiddenList.style.width=="0%") {
            hiddenbutton.style.transform="rotate(360deg)";
            //hiddenList_content.style.width = '120px';
            hiddenList.style.width='100%';
            setTimeout(()=>{hiddenList_content_ul.style.opacity = '1'}, 300);
            hiddenList_content_ul.style.display = 'block';
            hiddenHeaderElement();
            
          }
          else if(hiddenList.style.width=="100%" && hiddenList_content_ul.style.opacity == '1') {
            hiddenbutton.style.transform="rotate(0deg)";
            hiddenList_content_ul.style.opacity = '0';
            hiddenList.style.width='0%';
            hiddenList_content_ul.style.display = 'none'
            if(performanceDetailInformation.style.width !='100%') {
              if(dataDesignation_send.style.backgroundColor =='rgb(188, 229, 92)') {
                visibleHeaderElement('viewDateOnly');
              }
              else if(nowPlaying.style.backgroundColor =='rgb(188, 229, 92)') {
                visibleHeaderElement('viewPlayingOnly');
              }
              else {
                visibleHeaderElement('ALL');
              }
            }
            
            //hiddenList_content.style.width = '0px';
          }
        }
  
        function sub_nowPlaying() {
          let j = 0;
          let temp = [];
          let nowPerformenceBorderColor = scrollBar_ul_childCount.children[0];
          if(nowPlaying.firstChild.style.display == 'block') {
              //현재 상형중인 공연만 보여주기
              if(nowPlaying.className == 'false') {
                nowPlaying.className ='true';
                nowPlaying.style.backgroundColor = '#BCE55C';
                nowPlaying.style.transform="rotate(360deg)";

                if(nowPerformenceBorderColor == null) {
                  musicalInformation = [...temp];
                  showPerformance(musicalInformation, musicalMarker);
                }
                else if(nowPerformenceBorderColor.style.borderColor=="rgb(96, 63, 131)") {
                  for(let i = 0; i <musicalInformation.length; i++) {
                    if(musicalInformation[i].op_st_dt <= today) {
                      temp[j] = musicalInformation[i]; j++;
                    }
                  }
                  musicalInformation = [...temp];
                  showPerformance(musicalInformation, musicalMarker);
                }
                else if(nowPerformenceBorderColor.style.borderColor=="rgb(250, 208, 201)") {
                  for(let i = 0; i <operaInformation.length; i++) {
                    if( operaInformation[i].op_st_dt <= today) {
                      temp[j] = operaInformation[i]; j++;
                    }
                  }
                  operaInformation = [...temp];
                  showPerformance(operaInformation, operaMarker);
                }
                else if(nowPerformenceBorderColor.style.borderColor== "rgb(43, 174, 102)"){
                  for(let i = 0; i <playInformation.length; i++) {
                    if( playInformation[i].op_st_dt <= today) {
                      temp[j] = playInformation[i]; j++;
                    }
                  }
                  playInformation = [...temp];
                  showPerformance(playInformation, playMarker);
                }
                dateDesignation.style.opacity = '0';
                dateDesignation.style.visibility = 'hidden';
                dataDesignation_send.style.opacity = '0';
                dataDesignation_send.style.visibility = 'hidden';
                dataDesignation_send.value ='     ';
              }
              else if(nowPlaying.className == 'true') {
                nowPlaying.className ='false';
                nowPlaying.style.backgroundColor = '#EAEAEA';
                nowPlaying.style.transform="rotate(0deg)";

                if(checkMusical.checked) {
                  musicalInformation = [...tempMusicalInformation];
                  showPerformance(musicalInformation, musicalMarker);
                }
                else if(checkOpera.checked) {
                  operaInformation = [...tempOperaInformation];
                  showPerformance(operaInformation, operaMarker);
                }
                else if(checkPlay.checked){
                  playInformation = [...tempPlayInformation];
                  showPerformance(playInformation, playMarker);
                }
                dateDesignation.style.opacity = '1';
                dateDesignation.style.visibility = 'visible';
                dataDesignation_send.style.opacity = '1';
                dataDesignation_send.style.visibility = 'visible';
                dataDesignation_send.value ='확인';
              } 
          }
        }
        //Playing.. 버튼 클릭이벤트
        nowPlaying.onclick = function() {
          sub_nowPlaying();
        }

        function sub_sub_dateDesignation_send() {
          let j = 0;
          let temp = [];
          if(checkMusical.checked) {
              for(let i = 0; i <musicalInformation.length; i++) {
                if(musicalInformation[i].op_st_dt <= userInputDateValue && musicalInformation[i].op_ed_dt >= userInputDateValue) {
                  temp[j] = musicalInformation[i]; j++;
                }
              }
              musicalInformation = [...temp];
              showPerformance(musicalInformation, musicalMarker);
            }
            else if(checkOpera.checked) {
              for(let i = 0; i <operaInformation.length; i++) {
                if(operaInformation[i].op_st_dt <= userInputDateValue && operaInformation[i].op_ed_dt >= userInputDateValue) {
                  temp[j] = operaInformation[i]; j++;
                }
              }
              operaInformation = [...temp];
              showPerformance(operaInformation, operaMarker);
            }
            else if(checkPlay.checked){
              for(let i = 0; i <playInformation.length; i++) {
                 if(playInformation[i].op_st_dt <= userInputDateValue && playInformation[i].op_ed_dt >= userInputDateValue) {
                  temp[j] = playInformation[i]; j++;
                }
              }
              playInformation = [...temp];
              showPerformance(playInformation, playMarker);
          }
        }
        function sub_dataDesignation_send() {
          let j = 0;
          let temp = [];
          if(dataDesignation_send.value == "확인") {
              //현재 상형중인 공연만 보여주기
              if(dataDesignation_send.className == 'false') {
                dataDesignation_send.className ='true';
                dataDesignation_send.style.backgroundColor = '#BCE55C';
                dataDesignation_send.className ='true';
                dateDesignation.style.backgroundColor = '#BCE55C';
                nowPlaying.style.opacity = '0';
                nowPlaying.style.visibility = 'hidden';
                nowPlaying.firstChild.style.display = 'none';
                
                sub_sub_dateDesignation_send();
              }
              else if(dataDesignation_send.className == 'true') {
                dataDesignation_send.className ='false';
                dateDesignation.style.backgroundColor = '#EAEAEA';
                dataDesignation_send.style.backgroundColor = '#EAEAEA';
                nowPlaying.style.opacity = '1';
                nowPlaying.style.visibility = 'visible';
                nowPlaying.firstChild.style.display = 'block';

                if(checkMusical.checked) {
                  musicalInformation = [...tempMusicalInformation];
                  showPerformance(musicalInformation, musicalMarker);
                }
                else if(checkOpera.checked) {
                  operaInformation = [...tempOperaInformation];
                  showPerformance(operaInformation, operaMarker);
                }
                else if(checkPlay.checked){
                  playInformation = [...tempPlayInformation];
                  showPerformance(playInformation, playMarker);
                }
                dateDesignation.style.opacity = '1';
                dateDesignation.style.visibility = 'visible';
                dataDesignation_send.style.opacity = '1';
                dataDesignation_send.style.visibility = 'visible';
                dataDesignation_send.value ='확인';
              } 
          }
        }
        
        //날짜 입력 이벤트
        dateDesignation.value = today;
        dataDesignation_send.onclick = function() {
          console.log('???'+dateDesignation);
          userInputDateValue = dateDesignation.value;
          sub_dataDesignation_send();
        }
       
        
        
        
 </script>
 </body>
 </html>   
 
 